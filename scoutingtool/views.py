from django.shortcuts import render
from django.http import HttpResponse

from scoutingtool.classes.PlayerSelector import PlayerSelector
from scoutingtool.classes.VisualizationMaker import VisualizationMaker
from scoutingtool.forms import CritereaSelectorForm


def index(request): #show the form where users can specify what kind of player they want
    criterea_selection_form = CritereaSelectorForm()

    context = {'criterea_selection_form': criterea_selection_form}
    return render(request, 'critereaselection.html', context)

def submit_criterea(request): #when user submits the form
    # uncomment this after testing ↓
    if request.method == 'POST':
        criterea_selection_form = CritereaSelectorForm(request.POST)
        if criterea_selection_form.is_valid():

            playerselector = PlayerSelector(criterea_selection_form)
            selected_players, criterea_list = playerselector.sort_players()
            visualizationmaker = VisualizationMaker()
            playerdata = visualizationmaker.make_visualizations(selected_players, criterea_list)
            jsondata = str(playerdata).replace("'", '"')
            # uncomment this after testing ↑
            # print('JSON AND DICTS')
            # print(playerdata)
            # print(jsondata)
    # playerdata = {'1': {'id': '1', 'general_player_info': {'Naam': 'Achraf Dari', 'Geboortedatum': '6 mei 1999 ', 'Geboorteplaats': 'Casablanca\xa0\xa0 ', 'Leeftijd': '24', 'Lengte': '1,88\xa0m', 'Nationaliteit': 'Marokko', 'Positie': 'Verdediging - Centrale verdediger', 'Voet': 'rechts', 'Contract tot en met': '30 jun. 2026', 'foto_url': 'https://img.a.transfermarkt.technology/portrait/header/566823-1643125273.png?lm=1'}, 'transfer_value_info': {'2018-06-07': '100000', '2018-11-09': '400000', '2018-12-31': '650000', '2019-03-13': '800000', '2019-05-28': '850000', '2019-12-31': '875000', '2020-04-08': '800000', '2020-09-20': '600000', '2021-04-11': '800000', '2021-07-31': '1000000', '2021-12-01': '1200000', '2022-07-11': '1800000', '2022-09-19': '2500000', '2022-11-02': '2500000'}, 'criterea_specific_player_info': {'Goals per 90 mins': 0.48, 'Shots per 90 mins': 0.48, 'Shots on target per 90 mins': 0.48, 'Goals per shot': 1.0, 'Penalty success rate': 0.0}}, '2': {'id': '2', 'general_player_info': {'Naam': 'Andreas Christensen', 'Geboortedatum': '10 apr. 1996 ', 'Geboorteplaats': 'Lillerød\xa0\xa0 ', 'Leeftijd': '27', 'Lengte': '1,87\xa0m', 'Nationaliteit': 'Denemarken', 'Positie': 'Verdediging - Centrale verdediger', 'Voet': 'rechts', 'Contract tot en met': '30 jun. 2026', 'foto_url': 'https://img.a.transfermarkt.technology/portrait/header/196948-1668183241.jpg?lm=1'}, 'transfer_value_info': {'2014-10-05': '500000', '2015-02-12': '750000', '2015-07-01': '1500000', '2016-02-15': '6500000', '2016-04-13': '8000000', '2016-07-22': '14000000', '2017-02-07': '16000000', '2017-06-19': '18000000', '2018-01-02': '30000000', '2018-03-23': '40000000', '2018-05-28': '40000000', '2018-12-19': '35000000', '2019-06-13': '30000000', '2019-09-12': '35000000', '2019-12-10': '30000000', '2020-04-08': '24000000', '2020-10-13': '24000000', '2021-03-18': '28000000', '2021-05-26': '30000000', '2021-10-05': '35000000', '2021-12-23': '35000000', '2022-06-15': '35000000', '2022-11-07': '30000000'}, 'criterea_specific_player_info': {'Goals per 90 mins': 0.33, 'Shots per 90 mins': 0.67, 'Shots on target per 90 mins': 0.33, 'Goals per shot': 0.5, 'Penalty success rate': 0.0}}, '3': {'id': '3', 'general_player_info': {'Naam': 'Mohammed Salisu', 'Geboortedatum': '17 apr. 1999 ', 'Geboorteplaats': 'Kumasi\xa0\xa0 ', 'Leeftijd': '24', 'Lengte': '1,88\xa0m', 'Nationaliteit': 'Ghana', 'Positie': 'Verdediging - Centrale verdediger', 'Voet': 'links', 'Contract tot en met': '30 jun. 2024', 'foto_url': 'https://img.a.transfermarkt.technology/portrait/header/563963-1668428508.jpg?lm=1'}, 'transfer_value_info': {'2018-02-23': '100000', '2018-05-30': '100000', '2019-02-19': '250000', '2019-06-29': '250000', '2019-09-10': '2500000', '2019-12-20': '10000000', '2020-03-05': '12000000', '2020-04-08': '11000000', '2020-07-23': '12000000', '2020-10-13': '12000000', '2021-03-18': '10000000', '2021-06-08': '10000000', '2021-12-23': '10000000', '2022-03-29': '15000000', '2022-06-15': '18000000', '2022-11-03': '18000000'}, 'criterea_specific_player_info': {'Goals per 90 mins': 0.33, 'Shots per 90 mins': 0.67, 'Shots on target per 90 mins': 0.33, 'Goals per shot': 0.5, 'Penalty success rate': 0.0}}, '4': {'id': '4', 'general_player_info': {'Naam': 'Denzel Dumfries', 'Geboortedatum': '18 apr. 1996 ', 'Geboorteplaats': 'Rotterdam\xa0\xa0 ', 'Leeftijd': '27', 'Lengte': '1,88\xa0m', 'Nationaliteit': 'Nederland\xa0\xa0Aruba', 'Positie': 'Middenveld - Rechter middenveld', 'Voet': 'rechts', 'Contract tot en met': '30 jun. 2025', 'foto_url': 'https://img.a.transfermarkt.technology/portrait/header/321528-1663572270.jpg?lm=1'}, 'transfer_value_info': {'2014-10-30': '25000', '2015-02-21': '50000', '2015-07-01': '50000', '2016-02-05': '150000', '2016-07-15': '250000', '2016-10-17': '600000', '2017-01-18': '800000', '2017-06-07': '1000000', '2017-10-26': '1500000', '2018-01-17': '2500000', '2018-06-12': '4000000', '2018-10-04': '6000000', '2018-12-28': '12000000', '2019-06-12': '15000000', '2019-12-18': '13500000', '2020-03-12': '15000000', '2020-04-08': '12000000', '2020-10-14': '15000000', '2021-01-06': '18000000', '2021-05-27': '16000000', '2021-12-28': '16000000', '2022-03-15': '20000000', '2022-06-07': '25000000', '2022-11-11': '28000000'}, 'criterea_specific_player_info': {'Goals per 90 mins': 0.19, 'Shots per 90 mins': 0.19, 'Shots on target per 90 mins': 0.19, 'Goals per shot': 1.0, 'Penalty success rate': 0.0}}, '5': {'id': '5', 'general_player_info': {'Naam': 'Theo Hernández', 'Geboortedatum': '6 okt. 1997 ', 'Geboorteplaats': 'Marseille\xa0\xa0 ', 'Leeftijd': '25', 'Lengte': '1,84\xa0m', 'Nationaliteit': 'Frankrijk\xa0\xa0Spanje', 'Positie': 'Verdediging - Linkervleugelverdediger', 'Voet': 'links', 'Contract tot en met': '30 jun. 2026', 'foto_url': 'https://img.a.transfermarkt.technology/portrait/header/339808-1663574533.jpg?lm=1'}, 'transfer_value_info': {'2016-08-04': '1000000', '2016-10-27': '5000000', '2017-01-24': '10000000', '2017-06-05': '15000000', '2017-08-17': '20000000', '2018-01-01': '20000000', '2018-03-22': '15000000', '2018-05-30': '15000000', '2018-12-21': '15000000', '2019-06-11': '15000000', '2019-10-08': '18000000', '2019-12-12': '25000000', '2020-03-03': '40000000', '2020-04-08': '32000000', '2020-08-25': '45000000', '2020-12-29': '50000000', '2021-06-03': '50000000', '2021-12-28': '48000000', '2022-06-07': '55000000', '2022-11-11': '55000000', '2022-12-23': '60000000'}, 'criterea_specific_player_info': {'Goals per 90 mins': 0.18, 'Shots per 90 mins': 0.89, 'Shots on target per 90 mins': 0.35, 'Goals per shot': 0.2, 'Penalty success rate': 0.0}}}

    # playerdata = {'1': {'id': '1', 'general_player_info': {'Naam': 'Wout Weghorst', 'Geboortedatum': '7 aug. 1992 ', 'Geboorteplaats': 'Borne\xa0\xa0 ', 'Leeftijd': '30', 'Lengte': '1,97\xa0m', 'Nationaliteit': 'Nederland', 'Positie': 'Aanval - Centrumspits', 'Voet': 'rechts', 'Contract tot en met': '30 jun. 2025'}, 'transfer_value_info': {'2012-08-02': '50000', '2013-06-04': '100000', '2014-05-08': '175000', '2014-08-11': '300000', '2014-11-02': '500000', '2015-02-11': '750000', '2015-07-01': '900000', '2015-11-11': '1000000', '2016-02-05': '1250000', '2016-07-15': '1750000', '2017-01-18': '2500000', '2017-06-07': '2750000', '2017-10-26': '3500000', '2018-01-17': '4500000', '2018-03-27': '5500000', '2018-06-12': '7000000', '2018-08-22': '10000000', '2018-12-18': '13000000', '2019-03-06': '17000000', '2019-06-05': '20000000', '2019-10-02': '25000000', '2019-12-17': '27000000', '2020-04-08': '21500000', '2020-07-08': '30000000', '2021-02-10': '30000000', '2021-05-27': '30000000', '2021-12-22': '20000000', '2022-03-29': '17000000', '2022-06-15': '14000000', '2022-10-27': '14000000'}, 'criterea_specific_player_info': {'goals_per_90_mins': 2.86, 'shots_per_90_mins': 2.81, 'shots_on_target_per_90_mins': 2.81, 'goals_per_shot': 1.0, 'penalty_success_rate': 0.0}}, '2': {'id': '2', 'general_player_info': {'Naam': 'Niclas Füllkrug', 'Geboortedatum': 'Geen info bekend'}, 'transfer_value_info': {'2012-08-02': '50000', '2013-06-04': '100000', '2014-05-08': '175000', '2014-08-11': '300000', '2014-11-02': '500000', '2015-02-11': '750000', '2015-07-01': '900000', '2015-11-11': '1000000', '2016-02-05': '1250000', '2016-07-15': '1750000', '2017-01-18': '2500000', '2017-06-07': '2750000', '2017-10-26': '3500000', '2018-01-17': '4500000', '2018-03-27': '5500000', '2018-06-12': '7000000', '2018-08-22': '10000000', '2018-12-18': '13000000', '2019-03-06': '17000000', '2019-06-05': '20000000', '2019-10-02': '25000000', '2019-12-17': '27000000', '2020-04-08': '21500000', '2020-07-08': '30000000', '2021-02-10': '30000000', '2021-05-27': '30000000', '2021-12-22': '20000000', '2022-03-29': '17000000', '2022-06-15': '14000000', '2022-10-27': '14000000'}, 'criterea_specific_player_info': {'goals_per_90_mins': 2.5, 'shots_per_90_mins': 10.43, 'shots_on_target_per_90_mins': 3.91, 'goals_per_shot': 0.25, 'penalty_success_rate': 0.0}}, '3': {'id': '3', 'general_player_info': {'Naam': 'Rafael Leão', 'Geboortedatum': 'Geen info bekend'}, 'transfer_value_info': {'2012-08-02': '50000', '2013-06-04': '100000', '2014-05-08': '175000', '2014-08-11': '300000', '2014-11-02': '500000', '2015-02-11': '750000', '2015-07-01': '900000', '2015-11-11': '1000000', '2016-02-05': '1250000', '2016-07-15': '1750000', '2017-01-18': '2500000', '2017-06-07': '2750000', '2017-10-26': '3500000', '2018-01-17': '4500000', '2018-03-27': '5500000', '2018-06-12': '7000000', '2018-08-22': '10000000', '2018-12-18': '13000000', '2019-03-06': '17000000', '2019-06-05': '20000000', '2019-10-02': '25000000', '2019-12-17': '27000000', '2020-04-08': '21500000', '2020-07-08': '30000000', '2021-02-10': '30000000', '2021-05-27': '30000000', '2021-12-22': '20000000', '2022-03-29': '17000000', '2022-06-15': '14000000', '2022-10-27': '14000000'}, 'criterea_specific_player_info': {'goals_per_90_mins': 2.0, 'shots_per_90_mins': 5.11, 'shots_on_target_per_90_mins': 2.05, 'goals_per_shot': 0.4, 'penalty_success_rate': 0.0}}, '4': {'id': '4', 'general_player_info': {'Naam': 'Marcus Rashford', 'Geboortedatum': '31 okt. 1997 ', 'Geboorteplaats': 'Manchester\xa0\xa0 ', 'Leeftijd': '25', 'Lengte': '1,85\xa0m', 'Nationaliteit': 'Engeland\xa0\xa0Saint Kitts en Nevis', 'Positie': 'Aanval - Linksbuiten', 'Voet': 'rechts', 'Contract tot en met': '30 jun. 2024'}, 'transfer_value_info': {'2016-03-23': '3000000', '2016-06-01': '6000000', '2016-08-01': '7000000', '2016-10-24': '10000000', '2017-02-20': '10000000', '2017-06-28': '18000000', '2017-10-23': '30000000', '2018-01-02': '50000000', '2018-05-28': '65000000', '2018-12-19': '65000000', '2019-03-05': '80000000', '2019-06-13': '80000000', '2019-12-10': '80000000', '2020-04-08': '64000000', '2020-07-30': '80000000', '2020-10-13': '80000000', '2021-03-18': '85000000', '2021-05-28': '85000000', '2021-12-23': '85000000', '2022-03-29': '70000000', '2022-06-15': '60000000', '2022-11-03': '55000000'}, 'criterea_specific_player_info': {'goals_per_90_mins': 1.88, 'shots_per_90_mins': 7.07, 'shots_on_target_per_90_mins': 3.86, 'goals_per_shot': 0.27, 'penalty_success_rate': 0.0}}, '5': {'id': '5', 'general_player_info': {'Naam': 'Kai Havertz', 'Geboortedatum': '11 jun. 1999 ', 'Geboorteplaats': 'Aachen\xa0\xa0 ', 'Leeftijd': '23', 'Lengte': '1,93\xa0m', 'Nationaliteit': 'Duitsland', 'Positie': 'Middenveld - Aanvallend middenveld', 'Voet': 'links', 'Contract tot en met': '30 jun. 2025'}, 'transfer_value_info': {'2016-07-01': '100000', '2017-02-07': '1500000', '2017-03-22': '5000000', '2017-06-19': '8000000', '2017-12-28': '18000000', '2018-04-04': '25000000', '2018-06-05': '28000000', '2018-08-22': '35000000', '2018-10-22': '55000000', '2018-12-18': '65000000', '2019-06-05': '90000000', '2019-12-17': '90000000', '2020-04-08': '81000000', '2020-10-13': '81000000', '2021-03-18': '70000000', '2021-06-01': '70000000', '2021-12-23': '70000000', '2022-06-15': '70000000', '2022-11-03': '70000000'}, 'criterea_specific_player_info': {'goals_per_90_mins': 1.82, 'shots_per_90_mins': 4.41, 'shots_on_target_per_90_mins': 2.65, 'goals_per_shot': 0.4, 'penalty_success_rate': 0.0}}, '6': {'criterea_specific_player_info': {'goals_per_90_mins': 0.11019117647058829, 'shots_per_90_mins': 1.1262794117647057, 'shots_on_target_per_90_mins': 0.36316176470588235, 'goals_per_shot': 0.061764705882352944, 'penalty_success_rate': 0.01735294117647059}}}
    # jsondata = '{"1": {"id": "1", "general_player_info": {"Naam": "Wout Weghorst", "Geboortedatum": "7 aug. 1992 ", "Geboorteplaats": "Borne\xa0\xa0 ", "Leeftijd": "30", "Lengte": "1,97\xa0m", "Nationaliteit": "Nederland", "Positie": "Aanval - Centrumspits", "Voet": "rechts", "Contract tot en met": "30 jun. 2025"}, "transfer_value_info": {"2012-08-02": "50000", "2013-06-04": "100000", "2014-05-08": "175000", "2014-08-11": "300000", "2014-11-02": "500000", "2015-02-11": "750000", "2015-07-01": "900000", "2015-11-11": "1000000", "2016-02-05": "1250000", "2016-07-15": "1750000", "2017-01-18": "2500000", "2017-06-07": "2750000", "2017-10-26": "3500000", "2018-01-17": "4500000", "2018-03-27": "5500000", "2018-06-12": "7000000", "2018-08-22": "10000000", "2018-12-18": "13000000", "2019-03-06": "17000000", "2019-06-05": "20000000", "2019-10-02": "25000000", "2019-12-17": "27000000", "2020-04-08": "21500000", "2020-07-08": "30000000", "2021-02-10": "30000000", "2021-05-27": "30000000", "2021-12-22": "20000000", "2022-03-29": "17000000", "2022-06-15": "14000000", "2022-10-27": "14000000"}, "criterea_specific_player_info": {"goals_per_90_mins": 2.86, "shots_per_90_mins": 2.81, "shots_on_target_per_90_mins": 2.81, "goals_per_shot": 1.0, "penalty_success_rate": 0.0}}, "2": {"id": "2", "general_player_info": {"Naam": "Niclas Füllkrug", "Geboortedatum": "Geen info bekend"}, "transfer_value_info": {"2012-08-02": "50000", "2013-06-04": "100000", "2014-05-08": "175000", "2014-08-11": "300000", "2014-11-02": "500000", "2015-02-11": "750000", "2015-07-01": "900000", "2015-11-11": "1000000", "2016-02-05": "1250000", "2016-07-15": "1750000", "2017-01-18": "2500000", "2017-06-07": "2750000", "2017-10-26": "3500000", "2018-01-17": "4500000", "2018-03-27": "5500000", "2018-06-12": "7000000", "2018-08-22": "10000000", "2018-12-18": "13000000", "2019-03-06": "17000000", "2019-06-05": "20000000", "2019-10-02": "25000000", "2019-12-17": "27000000", "2020-04-08": "21500000", "2020-07-08": "30000000", "2021-02-10": "30000000", "2021-05-27": "30000000", "2021-12-22": "20000000", "2022-03-29": "17000000", "2022-06-15": "14000000", "2022-10-27": "14000000"}, "criterea_specific_player_info": {"goals_per_90_mins": 2.5, "shots_per_90_mins": 10.43, "shots_on_target_per_90_mins": 3.91, "goals_per_shot": 0.25, "penalty_success_rate": 0.0}}, "3": {"id": "3", "general_player_info": {"Naam": "Rafael Leão", "Geboortedatum": "Geen info bekend"}, "transfer_value_info": {"2012-08-02": "50000", "2013-06-04": "100000", "2014-05-08": "175000", "2014-08-11": "300000", "2014-11-02": "500000", "2015-02-11": "750000", "2015-07-01": "900000", "2015-11-11": "1000000", "2016-02-05": "1250000", "2016-07-15": "1750000", "2017-01-18": "2500000", "2017-06-07": "2750000", "2017-10-26": "3500000", "2018-01-17": "4500000", "2018-03-27": "5500000", "2018-06-12": "7000000", "2018-08-22": "10000000", "2018-12-18": "13000000", "2019-03-06": "17000000", "2019-06-05": "20000000", "2019-10-02": "25000000", "2019-12-17": "27000000", "2020-04-08": "21500000", "2020-07-08": "30000000", "2021-02-10": "30000000", "2021-05-27": "30000000", "2021-12-22": "20000000", "2022-03-29": "17000000", "2022-06-15": "14000000", "2022-10-27": "14000000"}, "criterea_specific_player_info": {"goals_per_90_mins": 2.0, "shots_per_90_mins": 5.11, "shots_on_target_per_90_mins": 2.05, "goals_per_shot": 0.4, "penalty_success_rate": 0.0}}, "4": {"id": "4", "general_player_info": {"Naam": "Marcus Rashford", "Geboortedatum": "31 okt. 1997 ", "Geboorteplaats": "Manchester\xa0\xa0 ", "Leeftijd": "25", "Lengte": "1,85\xa0m", "Nationaliteit": "Engeland\xa0\xa0Saint Kitts en Nevis", "Positie": "Aanval - Linksbuiten", "Voet": "rechts", "Contract tot en met": "30 jun. 2024"}, "transfer_value_info": {"2016-03-23": "3000000", "2016-06-01": "6000000", "2016-08-01": "7000000", "2016-10-24": "10000000", "2017-02-20": "10000000", "2017-06-28": "18000000", "2017-10-23": "30000000", "2018-01-02": "50000000", "2018-05-28": "65000000", "2018-12-19": "65000000", "2019-03-05": "80000000", "2019-06-13": "80000000", "2019-12-10": "80000000", "2020-04-08": "64000000", "2020-07-30": "80000000", "2020-10-13": "80000000", "2021-03-18": "85000000", "2021-05-28": "85000000", "2021-12-23": "85000000", "2022-03-29": "70000000", "2022-06-15": "60000000", "2022-11-03": "55000000"}, "criterea_specific_player_info": {"goals_per_90_mins": 1.88, "shots_per_90_mins": 7.07, "shots_on_target_per_90_mins": 3.86, "goals_per_shot": 0.27, "penalty_success_rate": 0.0}}, "5": {"id": "5", "general_player_info": {"Naam": "Kai Havertz", "Geboortedatum": "11 jun. 1999 ", "Geboorteplaats": "Aachen\xa0\xa0 ", "Leeftijd": "23", "Lengte": "1,93\xa0m", "Nationaliteit": "Duitsland", "Positie": "Middenveld - Aanvallend middenveld", "Voet": "links", "Contract tot en met": "30 jun. 2025"}, "transfer_value_info": {"2016-07-01": "100000", "2017-02-07": "1500000", "2017-03-22": "5000000", "2017-06-19": "8000000", "2017-12-28": "18000000", "2018-04-04": "25000000", "2018-06-05": "28000000", "2018-08-22": "35000000", "2018-10-22": "55000000", "2018-12-18": "65000000", "2019-06-05": "90000000", "2019-12-17": "90000000", "2020-04-08": "81000000", "2020-10-13": "81000000", "2021-03-18": "70000000", "2021-06-01": "70000000", "2021-12-23": "70000000", "2022-06-15": "70000000", "2022-11-03": "70000000"}, "criterea_specific_player_info": {"goals_per_90_mins": 1.82, "shots_per_90_mins": 4.41, "shots_on_target_per_90_mins": 2.65, "goals_per_shot": 0.4, "penalty_success_rate": 0.0}}, "6": {"criterea_specific_player_info": {"goals_per_90_mins": 0.11019117647058829, "shots_per_90_mins": 1.1262794117647057, "shots_on_target_per_90_mins": 0.36316176470588235, "goals_per_shot": 0.061764705882352944, "penalty_success_rate": 0.01735294117647059}}}'

    # #playerdata and jsondata contain the same info.
    # However, the django template language needs a dict, whereas JS needs JSON as a string. Decided to just pass both
    context = {'playerdata': playerdata, 'jsondata': jsondata}


    return render(request, 'resultspage.html', context)